<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‚ö° Pirate Neon Blackjack | Gavinbot Lair</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="The most advanced, futuristic pirate blackjack game ever. AI banter, powerups, unlocks, stats, and more.">
  <link rel="icon" href="gavinbot.png">
  <style>
    html,body { height:100%; margin:0; }
    body {
      min-height:100vh;
      background:linear-gradient(120deg,#160c28 0%,#232526 70%,#0ff 100%);
      color:#fff;
      font-family:'Orbitron','Trebuchet MS',Arial,sans-serif;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:0; margin:0;
      transition:background 1s;
      overflow-x:hidden;
    }
    body.coinrain {
      animation:coinrain-bg 1.7s;
    }
    @keyframes coinrain-bg {
      0% { background:#160c28;}
      50% { background:#ffd700;}
      100% { background:linear-gradient(120deg,#160c28 0%,#232526 70%,#0ff 100%);}
    }
    h1 {
      font-size:2.5em;
      text-shadow:0 0 18px #0ff,0 0 40px #19f7d2;
      margin-bottom:10px;
      letter-spacing:1px;
      font-family:'Orbitron',sans-serif;
      user-select:none;
    }
    .chips {
      font-size:1.2em;
      color:#ffd700;
      text-shadow:0 0 8px #0ff;
      margin-bottom:10px;
    }
    .game {
      background:rgba(24,28,55,0.95);
      border:2.5px solid #19f7d2;
      box-shadow:0 0 32px #0ff,0 0 55px #19f7d2;
      border-radius:18px;
      padding:2.3em 1.3em 1.5em 1.3em;
      min-width:320px;
      max-width:440px;
      margin:auto;
      position:relative;
      overflow:visible;
      transition:box-shadow .2s;
    }
    .dealer-avatar {
      width:75px;height:75px;
      border-radius:50%;
      background:linear-gradient(135deg,#0ff 30%,#232526 100%);
      border:3px solid #39ff14;
      box-shadow:0 0 22px #0ff,0 0 40px #0ff;
      display:flex;align-items:center;justify-content:center;
      font-size:2.4em;
      margin:auto 0 7px 0;
      transition:transform .4s,filter .4s;
      user-select:none;
    }
    .dealer-avatar.celebrate { transform:scale(1.18) rotate(-10deg);}
    .dealer-avatar.sad { filter:grayscale(.7) brightness(.8);}
    .dealer-avatar.angry { filter:contrast(1.5)  hue-rotate(200deg);}
    .dealer-avatar.unlock { border:3px solid #ffd700; background:linear-gradient(135deg,#ffe14b,#0ff 100%);}
    .dealer-name {
      font-size:1.1em;
      color:#39ff14; text-shadow:0 0 5px #0ff;
      margin-bottom:10px;
      font-family:'Orbitron',sans-serif;
      letter-spacing:.5px;
    }
    .bg-unlock { background:linear-gradient(120deg,#1b2a4d 0%,#ff007f 80%,#fff200 100%)!important; box-shadow:0 0 60px #ff007f,0 0 60px #fff200;}
    .hand {
      margin:1em 0 .5em 0;
      display:flex;flex-wrap:wrap;justify-content:center;gap:8px;
    }
    .card {
      display:inline-block;
      background:linear-gradient(135deg,#181e33 60%,#0ff 100%);
      color:#fff;
      border-radius:10px;
      border:2px solid #0ff;
      min-width:42px; padding:.7em .8em;
      font-size:1.3em;
      font-family:'Orbitron',monospace;
      position:relative;
      box-shadow:0 0 15px #0ff;
      animation:deal .7s cubic-bezier(.5,1.5,.7,1);
      user-select:none;
      transition:background .2s, border .2s, color .2s;
    }
    @keyframes deal {
      from { transform:translateY(-50px) scale(.7) rotate(-12deg); opacity:0;}
      to   { transform:translateY(0) scale(1) rotate(0); opacity:1;}
    }
    .card.revealed { background:linear-gradient(135deg,#19f7d2 10%,#fff 100%); color:#111;}
    .card.xray { border:2px solid #39ff14; background:linear-gradient(135deg,#232532 55%,#39ff14 100%);}
    .dealer-hand .card:not(.revealed):not(.xray) { filter:blur(2px) brightness(.7);}
    .totals {
      color:#39ff14;
      font-family:'Orbitron',sans-serif;
      font-size:1.12em; margin:.3em 0 .5em; letter-spacing:.6px;
      text-shadow:0 0 6px #0ff;
    }
    .msg {
      font-size:1.13em;
      min-height:2.2em;
      margin:1em auto .2em; padding:.3em .8em;
      color:#ffd700;
      text-shadow:0 0 7px #0ff,0 0 15px #0ff;
      font-family:'Orbitron',sans-serif;letter-spacing:.2px;
      user-select:none;
    }
    .banter {
      font-size:.98em;
      color:#39ff14;
      font-family:'Trebuchet MS',sans-serif;
      margin-bottom:1em;
      min-height:1.8em;
      text-shadow:0 0 5px #19f7d2;
      user-select:none;
    }
    .actions { margin:1.2em 0 0 0;}
    .actions button {
      background:linear-gradient(135deg,#0ff 60%,#19f7d2 100%);
      color:#111; border:none;
      border-radius:10px;
      font-family:'Orbitron',sans-serif;
      font-size:1.14em; font-weight:700;
      padding:.7em 1.2em;
      margin:.6em .5em;
      box-shadow:0 0 12px #19f7d2,0 0 28px #0ff;
      cursor:pointer; outline:none;
      transition:background .15s, color .15s, transform .15s;
    }
    .actions button:disabled { background:#1a2329; color:#777; box-shadow:none; cursor:not-allowed;}
    .powerups {
      margin:1.2em 0 .2em 0;
      display:flex;flex-wrap:wrap;justify-content:center;gap:13px;
    }
    .powerups button {
      background:linear-gradient(135deg,#39ff14 60%,#0ff 100%);
      color:#111; border:none;
      border-radius:10px;
      font-family:'Orbitron',sans-serif;
      font-size:.97em; font-weight:600;
      padding:.5em 1em;
      box-shadow:0 0 10px #39ff14,0 0 20px #19f7d2;
      cursor:pointer; outline:none;
      transition:background .15s, color .15s;
    }
    .powerups button:disabled { background:#112; color:#555; box-shadow:none;}
    .stats {
      margin:1.3em 0 0 0;
      color:#19f7d2;
      font-family:'Orbitron',sans-serif;
      font-size:.99em;
      opacity:.8;
    }
    .sound-toggle {
      position:absolute;top:10px;right:13px;
      background:#232526;color:#0ff;border:1.5px solid #0ff;
      border-radius:7px;padding:4px 12px;cursor:pointer;
      font-family:'Orbitron',sans-serif;font-size:.93em;z-index:2;
      box-shadow:0 0 8px #0ff;
      transition:background .18s, color .18s;
    }
    .sound-toggle.active { background:#0ff; color:#111;}
    .coinrain-anim {
      pointer-events:none;
      position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999;
      overflow:hidden;
      opacity:1;animation:coinrain-fadeout 2.5s forwards;
    }
    @keyframes coinrain-fadeout { 0%{opacity:1;} 100%{opacity:0;}}
    .coin {
      position:absolute;top:-40px;
      font-size:2.1em;
      animation:coinfall 1.5s cubic-bezier(.3,1.35,.6,1.06) forwards;
      user-select:none;
      pointer-events:none;
      text-shadow:0 0 12px #ffd700,0 0 24px #fff;
    }
    @keyframes coinfall {
      0%{transform:translateY(0) rotate(0);}
      60%{transform:translateY(60vh) rotate(180deg);}
      100%{transform:translateY(100vh) rotate(360deg);}
    }
    .unlock-badge {
      position:absolute;
      bottom:-30px;
      left:50%;
      transform:translateX(-50%);
      background:linear-gradient(135deg,#fff200,#ff007f 90%);
      color:#181e33;
      font-family:'Orbitron',sans-serif;
      font-size:1.05em;
      font-weight:900;
      padding:8px 22px;
      border-radius:16px;
      box-shadow:0 0 16px #fff200,0 0 32px #ff007f;
      border:3px solid #fff;
      letter-spacing:.6px;
      z-index:4;
      animation:badgefade 1.6s;
      user-select:none;
    }
    @keyframes badgefade { 0%{opacity:0;transform:translateX(-50%) scale(0.4);} 30%{opacity:1;} 100%{opacity:1;transform:translateX(-50%) scale(1);} }
    @media (max-width:510px) {
      .game { padding:1.1em .4em 1.5em .4em; min-width:220px; max-width:99vw;}
      .dealer-avatar { width:55px;height:55px;font-size:1.5em;}
      .unlock-badge { font-size:.95em; bottom:-22px;}
    }
  </style>
</head>
<body>
  <h1>‚ö° Pirate Neon Blackjack</h1>
  <div class="chips">üí∞ Pieces of Eight: <span id="chips">500</span></div>
  <div class="game" id="gameboard">
    <button class="sound-toggle" id="soundBtn" title="Toggle sound">üîä</button>
    <div class="dealer-avatar" id="dealerAvatar" title="AI Pirate Dealer">ü¶ú</div>
    <div class="dealer-name" id="dealerName">Captain Gavinbot</div>
    <div class="banter" id="banter">Welcome to the Neon Lair! ü¶ú</div>
    <div>
      <b>Your Hand:</b>
      <div class="hand player-hand" id="playerHand"></div>
      <div class="totals">Total: <span id="playerTotal">0</span></div>
    </div>
    <div>
      <b>Dealer:</b>
      <div class="hand dealer-hand" id="dealerHand"></div>
      <div class="totals">Total: <span id="dealerTotal">?</span></div>
    </div>
    <div class="msg" id="msg"></div>
    <div class="powerups">
      <button id="xrayBtn" title="Peek at one hidden dealer card!">üëÅÔ∏è X-Ray Vision</button>
      <button id="hackBtn" title="Swap your worst card - once per round!">ü§ñ Hack the Deck</button>
    </div>
    <div class="actions">
      <button id="hitBtn">Hit</button>
      <button id="standBtn">Stand</button>
      <button id="restartBtn" style="display:none;">Play Again</button>
    </div>
    <div class="stats" id="stats"></div>
  </div>
  <p style="margin:2em 0 0 0; text-align:center;"><a href="index.html" style="color:#0ff;">üè¥ Back to Main Site</a></p>
  <audio id="soundDeal" src="https://cdn.pixabay.com/audio/2022/07/26/audio_12bfa5f2e1.mp3"></audio>
  <audio id="soundWin" src="https://cdn.pixabay.com/audio/2022/07/26/audio_12db5c4e4a.mp3"></audio>
  <audio id="soundLose" src="https://cdn.pixabay.com/audio/2022/07/26/audio_12bcf7f5d1.mp3"></audio>
  <script>
    // --- Core Variables ---
    const suits = ["‚ô†", "‚ô•", "‚ô¶", "‚ô£"];
    const values = [2,3,4,5,6,7,8,9,10,"J","Q","K","A"];
    let deck, player, dealer, playerStands, gameOver, playerChips=500;
    let sessionStats = {wins:0, losses:0, streak:0, maxStreak:0};
    let xrayUsed = false, hackUsed = false, soundOn = true, unlockLevel = 0;
    let nextWinDouble = false, gavinEvent = null;
    let leaderboard = JSON.parse(localStorage.getItem('leaderboard')||"[]");

    const banterLines = [
      "Arrr! Lady Luck is with ye, matey.",
      "Gavinbot says: The cards are neon-hot tonight.",
      "Did you count cards? Or just parrots?",
      "Blackjack? Or just black coffee?",
      "My circuits say: hit, hit, HIT! (Or‚Ä¶ maybe not)",
      "Swab the decks if you lose!",
      "I deal with honor. Or do I? ü¶ú"
    ];
    const winLines = [
      "Shiver me timbers, you win! üèÜ",
      "A clean win! Neon coins for you.",
      "You bested me, matey. This round, at least.",
      "AI parrot bows to your cunning!",
      "Blackjack! You're a legend.",
      "That was masterful, pirate."
    ];
    const loseLines = [
      "Oof! The cyber-seas were rough.",
      "Dealer takes the loot! Try again?",
      "Not your round, pirate.",
      "Neon luck wasn't with you, matey.",
      "Squawk! Try again, captain?"
    ];
    const gavinSquawk = [
      {text:"ü¶ú GAVINBOT SQUAWK: The next win gets double coins!", fx:()=>{ nextWinDouble=true;}},
      {text:"ü¶ú GAVINBOT SQUAWK: A coin rain bonus event!", fx:()=>{ coinRain(); playerChips+=30; showMsg('Coin Rain! +30 coins!'); }},
      {text:"ü¶ú GAVINBOT SQUAWK: Dealer reveals a secret card.", fx:()=>{ dealer[1].revealed=true; render(); }},
      {text:"ü¶ú GAVINBOT SQUAWK: You get a free hack this round!", fx:()=>{ hackUsed=false; document.getElementById('hackBtn').disabled=false; }},
      {text:"ü¶ú GAVINBOT SQUAWK: You get a win streak badge if you win next round!", fx:()=>{ unlockLevel = Math.max(unlockLevel,1); showUnlock('Streak Badge Unlocked!'); }}
    ];

    // --- Utility Functions ---
    function shuffleDeck() {
      let d = [];
      for (let s of suits) for (let v of values) d.push({v,s});
      for (let i=d.length-1; i>0; i--) {
        let j = Math.floor(Math.random()*(i+1));
        [d[i],d[j]] = [d[j],d[i]];
      }
      return d;
    }
    function handValue(hand) {
      let val=0,aces=0;
      for (let c of hand) {
        if (c.v==="A") { val += 11; aces++; }
        else if (["K","Q","J"].includes(c.v)) val += 10;
        else val += c.v;
      }
      while (val>21 && aces) { val -=10; aces--; }
      return val;
    }
    function sleep(ms) { return new Promise(r=>setTimeout(r,ms)); }
    function playSound(id) { if(!soundOn) return; const el=document.getElementById(id); el.currentTime=0; el.play(); }
    function coinRain() {
      document.body.classList.add('coinrain');
      let rain = document.createElement('div'); rain.className='coinrain-anim';
      for(let i=0;i<22;i++) {
        let c=document.createElement('div');
        c.className='coin'; c.style.left = (Math.random()*95)+'vw';
        c.style.animationDelay=(Math.random()*1.3)+'s';
        c.textContent='ü™ô';
        rain.appendChild(c);
      }
      document.body.appendChild(rain);
      setTimeout(()=>{rain.remove();document.body.classList.remove('coinrain');},1900);
    }
    function showUnlock(txt) {
      let b = document.createElement('div');
      b.className = 'unlock-badge'; b.textContent = txt;
      document.getElementById('gameboard').appendChild(b);
      document.getElementById('dealerAvatar').classList.add('unlock');
      document.getElementById('gameboard').classList.add('bg-unlock');
      setTimeout(()=>{b.remove();document.getElementById('dealerAvatar').classList.remove('unlock');document.getElementById('gameboard').classList.remove('bg-unlock');},2600);
    }

    // --- Render Functions ---
    function render() {
      // Player Hand
      document.getElementById('playerHand').innerHTML =
        player.map((c,i)=>
          `<span class="card${(hackUsed && i===worstCardIndex(player))?' xray':''}">${c.v}${c.s}</span>`
        ).join('');
      document.getElementById('playerTotal').textContent = handValue(player);

      // Dealer Hand
      let showAll = playerStands || gameOver;
      document.getElementById('dealerHand').innerHTML =
        dealer.map((c, i)=>
          `<span class="card${(showAll||c.revealed)?' revealed':''}${(xrayUsed && i===1 && !showAll)?' xray':''}">${(showAll||c.revealed|| (xrayUsed&&i===1))?`${c.v}${c.s}`:'üÇ†'}</span>`
        ).join('');
      document.getElementById('dealerTotal').textContent = (showAll?handValue(dealer):"?");
      document.getElementById('chips').textContent = playerChips;
      document.getElementById('stats').innerHTML =
        `Wins: ${sessionStats.wins} | Losses: ${sessionStats.losses} | Streak: ${sessionStats.streak} | Max Streak: ${sessionStats.maxStreak}`;
    }
    function worstCardIndex(hand) {
      let min = 15, idx = -1;
      hand.forEach((c, i) => {
        let v = (c.v === "A") ? 11 : (["K","Q","J"].includes(c.v)?10:c.v);
        if (v < min) { min = v; idx = i; }
      });
      return idx;
    }
    function randomBanter() {
      if(Math.random()<0.14) {
        gavinEvent = gavinSquawk[Math.floor(Math.random()*gavinSquawk.length)];
        document.getElementById('banter').textContent = gavinEvent.text;
        if(gavinEvent.fx) gavinEvent.fx();
      } else {
        document.getElementById('banter').textContent = banterLines[Math.floor(Math.random()*banterLines.length)];
        gavinEvent = null;
      }
    }
    function dealerMood(mood) {
      const avatar = document.getElementById('dealerAvatar');
      avatar.className = "dealer-avatar " + (mood||"");
      setTimeout(()=>{avatar.className="dealer-avatar";}, 1500);
    }
    function showMsg(txt) { document.getElementById('msg').textContent=txt; }

    // --- Game Logic ---
    async function dealInitial() {
      deck = shuffleDeck();
      player = [deck.pop(), deck.pop()];
      dealer = [deck.pop(), deck.pop()];
      playerStands = false;
      gameOver = false;
      xrayUsed = false;
      hackUsed = false;
      document.getElementById('xrayBtn').disabled = false;
      document.getElementById('hackBtn').disabled = false;
      showMsg('');
      document.getElementById('restartBtn').style.display = "none";
      document.getElementById('hitBtn').disabled = false;
      document.getElementById('standBtn').disabled = false;
      document.getElementById('dealerAvatar').textContent = "ü¶ú";
      render();
      randomBanter();
      playSound('soundDeal');
      await sleep(350);
      render();
    }
    async function hit() {
      player.push(deck.pop());
      playSound('soundDeal');
      render();
      let pv = handValue(player);
      if (pv > 21) return await endGame("Bust! Dealer wins.", false);
      if (pv === 21) showMsg("21! Stand or try your luck?");
    }
    async function stand() {
      playerStands = true;
      document.getElementById('hitBtn').disabled = true;
      document.getElementById('standBtn').disabled = true;
      // Dealer reveals
      while (handValue(dealer) < 17) {
        dealer.push(deck.pop());
        playSound('soundDeal');
        render();
        await sleep(530);
      }
      render();
      let pv = handValue(player), dv = handValue(dealer);
      if (dv > 21) return await endGame("Dealer busts! You win!", true);
      if (pv === dv) return await endGame("Push. It's a tie!", null);
      if (pv > dv) return await endGame("You win! üè¥‚Äç‚ò†Ô∏è", true);
      return await endGame("Dealer wins.", false);
    }
    async function endGame(msg, win) {
      gameOver = true;
      showMsg(msg);
      document.getElementById('restartBtn').style.display = "inline-block";
      document.getElementById('hitBtn').disabled = true;
      document.getElementById('standBtn').disabled = true;
      document.getElementById('xrayBtn').disabled = true;
      document.getElementById('hackBtn').disabled = true;
      let avatar = document.getElementById('dealerAvatar');
      if (win === true) {
        sessionStats.wins++;
        sessionStats.streak++;
        if(sessionStats.streak>sessionStats.maxStreak) sessionStats.maxStreak=sessionStats.streak;
        let payout = nextWinDouble?40:20;
        playerChips+=payout;
        showMsg(msg+(nextWinDouble?" (Double coins: +40!)":" (+20 coins)"));
        nextWinDouble=false;
        avatar.textContent = "üòé";
        dealerMood("celebrate");
        playSound('soundWin');
        showBanterLine(winLines);
        if(sessionStats.streak===3) { unlockLevel = Math.max(unlockLevel,1); showUnlock('üî• Neon Streak Unlocked!'); }
        if(sessionStats.streak===5) { unlockLevel = Math.max(unlockLevel,2); showUnlock('üíé Max Pirate Unlocked!'); }
        updateLeaderboard();
      } else if (win === false) {
        sessionStats.losses++;
        sessionStats.streak=0;
        let lose = 15;
        playerChips-=lose;
        avatar.textContent = "üò†";
        dealerMood("angry");
        playSound('soundLose');
        showMsg(msg+" (-15 coins)");
        showBanterLine(loseLines);
        updateLeaderboard();
      } else {
        avatar.textContent = "ü§ñ";
        dealerMood("sad");
        showBanterLine(["A close game, matey."]);
      }
      render();
    }
    function showBanterLine(arr) {
      setTimeout(()=>{document.getElementById('banter').textContent = arr[Math.floor(Math.random()*arr.length)];}, 800);
    }

    // --- Powerups ---
    document.getElementById('xrayBtn').onclick = function() {
      if(xrayUsed) return;
      xrayUsed=true;
      render();
      this.disabled=true;
      showMsg("üëÅÔ∏è X-ray: You peeked at a dealer's hidden card!");
    };
    document.getElementById('hackBtn').onclick = function() {
      if(hackUsed) return;
      let idx = worstCardIndex(player);
      if(idx !== -1) {
        player[idx] = deck.pop();
        hackUsed=true;
        render();
        this.disabled=true;
        showMsg("ü§ñ Hack: Swapped your weakest card!");
      }
    };
    // Main Buttons
    document.getElementById('hitBtn').onclick = hit;
    document.getElementById('standBtn').onclick = stand;
    document.getElementById('restartBtn').onclick = async function(){ await dealInitial();};

    // Sound toggle
    document.getElementById('soundBtn').onclick = function() {
      soundOn = !soundOn;
      this.classList.toggle("active", soundOn);
      this.textContent = soundOn ? "üîä" : "üîá";
    };

    // --- Session Leaderboard (Local) ---
    function updateLeaderboard() {
      let entry = {date:Date.now(), chips:playerChips, streak:sessionStats.streak, maxStreak:sessionStats.maxStreak};
      leaderboard.push(entry);
      leaderboard = leaderboard.slice(-10); // Keep last 10 sessions
      localStorage.setItem('leaderboard',JSON.stringify(leaderboard));
    }

    // --- Start Game ---
    dealInitial();

    // Easter egg: change avatar/background on unlocks
    setInterval(()=>{
      if(unlockLevel===2) {
        document.getElementById('dealerAvatar').textContent="üíé";
        document.getElementById('dealerName').textContent="Queen Neonbot";
        document.getElementById('gameboard').classList.add('bg-unlock');
      } else if(unlockLevel===1) {
        document.getElementById('dealerAvatar').textContent="ü¶ú";
        document.getElementById('dealerName').textContent="Captain Gavinbot";
        document.getElementById('gameboard').classList.add('bg-unlock');
      }
    },3200);

    // Developer tool: Reset leaderboard with Shift+R
    document.addEventListener('keydown',e=>{
      if(e.shiftKey && e.key==='R') {
        leaderboard=[];localStorage.setItem('leaderboard','[]');
        showUnlock('Leaderboard reset!');
      }
    });
  </script>
</body>
</html>
